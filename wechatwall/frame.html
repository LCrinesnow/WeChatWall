<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wx client</title>
  <style>
    li > img{
      width: 32px;
    }
  </style>
</head>
<body>
	微信墙啊
  <a href="#end" id="toend"></a>
  <ul id="messages">
  
  </ul>
  <a name="end"></a>
<script type="text/javascript">
  var msglist = document.getElementById('messages');
  var ws = new WebSocket('ws://www.coderwitkey.com:10002/');
  var toend = document.getElementById('toend');
      console.log("=================="+ws);

  ws.onmessage = function(evt)
  {
    console.log(evt.data);
    var msg = JSON.parse(evt.data);
    msg.user = msg.user || {};
    var userName = msg.user.nickname;
    var headimg = msg.user.headimgurl;
    
    var oLi = document.createElement('li');
    if (msg.xml.MsgType == 'text') {
      var content = msg.xml.Content[0];
      oLi.innerHTML = userName + '<img src="'+headimg+'">' + '说:' + content;
    } else if (msg.xml.MsgType == 'image') {
	  var mediaId = msg.xml.MediaId
	  var access_token = msg.user.access_token
      oLi.innerHTML = userName + '<img src="'+headimg+'">' + '说:' + '<img src="' + 'http://file.api.weixin.qq.com/cgi-bin/media/get?access_token=' + 
	                  access_token + '&media_id=' + mediaId + '" style="display:block;width:20%;">'
      //oLi.innerHTML = userName + '<img src="'+headimg+'">' + '说:' + picUrl
	} else if (msg.xml.MsgType == 'voice') {
	  var mediaId = msg.xml.MediaId
	  var access_token = msg.user.access_token
	  var htmlvoice = '<object width="200" height="20" classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="http://www.apple.com/qtactivex/qtplugin.cab">' + 
                        '<embed src="' + 'http://file.api.weixin.qq.com/cgi-bin/media/get?access_token=' + access_token + '&media_id=' + mediaId + '"  autostart="false" width="200" height="20" controller="true" align="middle" bgcolor="black" target="myself" type="video/quicktime" pluginspage="http://www.apple.com/quicktime/download/index.html"/>' + 
                      '</object>'
	  oLi.innerHTML = userName + '<img src="'+headimg+'">' + '说:' + htmlvoice;
	  //oLi.innerHTML = 'http://file.api.weixin.qq.com/cgi-bin/media/get?access_token=' + access_token + '&media_id=' + mediaId
	} else if (msg.xml.MsgType == 'video') {
	  var mediaId = msg.xml.MediaId
	  var thumbMediaId = msg.xml.ThumbMediaId
	  var access_token = msg.user.access_token
	  oLi.innerHTML = userName + '<img src="'+headimg+'">' + '说:' + '<img src="' + 'http://file.api.weixin.qq.com/cgi-bin/media/get?access_token=' + access_token + '&media_id=' + thumbMediaId + '" style="display:block;width:20%;">' 
	} else if (msg.xml.MsgType == 'shortvideo') {
	  var mediaId = msg.xml.MediaId
	  var thumbMediaId = msg.xml.ThumbMediaId
	  var access_token = msg.user.access_token
	  var htmlsv = '<video width="320" height="240" controls="controls" autoplay="autoplay">' +
                   '<source src="' + 'http://file.api.weixin.qq.com/cgi-bin/media/get?access_token=' + access_token + '&media_id=' + mediaId + '" type="video/mp4" />' +
                   '</video>'
	  oLi.innerHTML = userName + '<img src="'+headimg+'">' + '说:' + htmlsv
	} else if (msg.xml.MsgType == 'location') {
	  var location_X = msg.xml.Location_X
	  var location_Y = msg.xml.Location_Y
	  var label = msg.xml.Label
	  oLi.innerHTML = userName + '<img src="'+headimg+'">' + '说:我在' + location_X + '纬度,' + location_Y + '经度,' + label
	} else if (msg.xml.MsgType == 'link') {
	  var title  = msg.xml.Title
	  var description = msg.xml.Description
	  var url = msg.xml.Url
	  oLi.innerHTML = userName + '<img src="'+headimg+'">' + '说:' + '<a href="' + url + '" target="_blank">' + title + '</a>' + 
	                  '<br>' + description
	}
	
    msglist.appendChild(oLi);
	toend.click()
  };
</script>
</body>
</html>